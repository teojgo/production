# omlins, kraushm, jg, havogt (cscs)
easyblock = 'CMakeMake'

name = 'STELLA'
version = '4a5f9c5'
versionsuffix = '-crclim-double-cuda'

homepage = "https://github.com/C2SM-RCM/stella (-b crclim)"
description = 'STELLA'

toolchain = {'name': 'CrayGNU', 'version': '22.05'}
toolchainopts = {'verbose': False}

# c2sm repository is private and there is no official release
sources = ['/apps/common/UES/easybuild/sources/%(nameletterlower)s/%(name)s/%(namelower)s_%(version)s.tar.gz']

builddependencies = [
    ('CMake', '3.14.5', '', True),
]
dependencies = [
    ('craype-accel-nvidia60', EXTERNAL_MODULE),
    ('Serialbox', '2.4.1'),
    ('Boost', '1.67.0'),
]

preconfigopts = "module swap gcc gcc/8.1.0 && module swap cudatoolkit cudatoolkit/11.2.0_3.39-2.1__gf93aa1c &&"
prebuildopts = "module swap gcc gcc/8.1.0 && module swap cudatoolkit cudatoolkit/11.2.0_3.39-2.1__gf93aa1c &&"

configopts = "-DBoost_INCLUDE_DIR=${EBROOTBOOST}/include -DCMAKE_BUILD_TYPE=Release -DX86_BACKEND=ON -DSINGLEPRECISION=OFF -DCUDA_BACKEND=ON -DCUDA_COMPUTE_CAPABILITY=sm_60 -DSTELLA_KSIZE=60 -DSTELLA_KFLAT=19 -DENABLE_OPENMP=OFF -DGCL=ON -DSTELLA_BITREPRO=OFF "

separate_build_dir = True

moduleclass = 'devel'
